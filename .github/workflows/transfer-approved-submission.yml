name: "Transfer Accepted Submission to Private Repo"

on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: "Issue number to transfer"
        required: true
        type: number

permissions:
  contents: read
  issues: write

jobs:
  transfer-submission:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Transfer Issue to Private Repo
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          script: |
            const issue_number = parseInt(core.getInput("issue_number"));
            const repoOwner = context.repo.owner;
            const publicRepo = context.repo.repo;
            const privateRepo = "pytorch-fdn/ambassador-program-management";
            const assignee = "reginankenchor";

            const issue = await github.rest.issues.get({
              owner: repoOwner,
              repo: publicRepo,
              issue_number
            });

            const hasAcceptedLabel = issue.data.labels.some(
              l => l.name.toLowerCase().includes("accept")
            );

            if (!hasAcceptedLabel) {
              throw new Error(`Issue #${issue_number} does not have an 'Accepted' label. Aborting transfer.`);
            }

            const bodyContent = [
              "ğŸ“ Submission Transferred from Public Repository",
              "",
              "----------------------------------------",
              issue.data.body || "",
              "----------------------------------------",
              `ğŸ”” @${assignee} â€” this submission has been accepted and is now ready for program-level follow-up.`
            ].join("\n\n");

            const newIssue = await github.rest.issues.create({
              owner: "pytorch-fdn",
              repo: "ambassador-program-management",
              title: issue.data.title,
              body: bodyContent,
              assignees: [assignee]
            });

            const confirmation = [
              "âœ… This submission has been **accepted** and transferred to the private program management repository.",
              "",
              `ğŸ”— [View it here](${newIssue.data.html_url})`,
              "",
              "â„¹ï¸ This issue remains open here for visibility, but ongoing tracking happens in the private repository."
            ].join("\n\n");

            await github.rest.issues.createComment({
              owner: repoOwner,
              repo: publicRepo,
              issue_number,
              body: confirmation
            });
